= Skillet

An easy-to-deploy standalone Rack app with bundled Chef server and cookbooks.

== Rationale

Hey, wouldn't it be cool to run a Chef server on Heroku?

== Deployment

As a prerequisite, you'll need access to a CouchDB instance somehow somewhere. (As one option, see my hideabed[http://github.com/matthewtodd/hideabed]. I hear there's also http://hosting.couch.io.)

I happen to be using Heroku. Here's how you'd deploy there:

 git clone http://github.com/matthewtodd/skillet.git
 cd skillet
 # adjust cookbooks to your liking
 heroku create
 heroku config:add APP_ACCESS_TOKEN=acbd18db4cc2f85cedef654fccc4a4d8
 heroku config:add MERB_SESSION_SECRET_KEY=37b51d194a7513e45b56f6524f2d51f2
 heroku config:add CHEF_AUTHORIZED_OPENID_IDENTIFIERS=one.example.com,two.example.com
 heroku config:add CHEF_AUTHORIZED_OPENID_PROVIDERS=provider.example.com,another-provider.example.com
 heroku config:add CHEF_COUCHDB_URL=https://user:pass@couchdb-instance.example.com
 heroku config:add CHEF_OPENID_URL=https://acbd18db4cc2f85cedef654fccc4a4d8:X@curried-emu-12.heroku.com
 heroku config:add CHEF_VALIDATION_TOKEN=73feffa4b7f6bb68e44cf984c85f6e88
 heroku addons:add piggyback_ssl
 git push heroku master

Then, assuming your APP_ACCESS_TOKEN is "acbd18db4cc2f85cedef654fccc4a4d8" and your app is "curried-emu-12", give it a go with

 open https://acbd18db4cc2f85cedef654fccc4a4d8:X@curried-emu-12.heroku.com

You'll need to crank your dynos to 2 so that your Chef clients can register and authenticate themselves with OpenID.

== Notes

It would be great if Heroku[http://docs.heroku.com/constraints#git-submodules] supported[http://groups.google.com/group/heroku/browse_thread/thread/5e6807fcd2572f64/bee1a3b581db9c00] git submodules. Then we could pull in Opscode's cookbooks[http://github.com/opscode/cookbooks] instead of duplicating them.

I've made a few patches: see config/init.rb[http://github.com/matthewtodd/skillet/blob/master/config/init.rb] and slices/chef-server-slice[http://github.com/matthewtodd/skillet/tree/master/slices/chef-server-slice/app].

Most notably, I've totally stubbed out Chef::Queue, so there's no search indexing. I don't know if this is a big deal yet.

The rest of the patches (CHEF-430[http://tickets.opscode.com/browse/CHEF-430], CHEF-431[http://tickets.opscode.com/browse/CHEF-431], and CHEF-432[http://tickets.opscode.com/browse/CHEF-432]) are currently being applied to Chef proper. With any luck, they'll be included in the 0.7.6 release! It will be nice, from a cognitive accessibility standpoint, to whack the slices directory as well as the Chef::REST monkey patch in init.rb.

== Cookbooks

Rather than keep all my separate cookbooks at the top level of the project, I've nested them here.

cookbooks:: A vendored copy of http://github.com/opscode/cookbooks. It's a shame Heroku doesn't support git submodules.
skillet-cookbooks:: Skillet-specific overrides to the Opscode cookbooks. For now, this just means patching the client.rb config template for chef::client to make it easier to point back to the skillet (chef) server automatically. I feel like it's nicer to keep the skillet-specific overrides separate from my custom site cookbooks, since it makes it easier for you to just blow away "site" and put your own stuff in.
site-cookbooks:: My own cookbooks, for my own nefarious purposes.
